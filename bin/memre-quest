#!/bin/bash

# MEMre.quest - Advanced LLM Memory & Context Window Management
# Rebranded claude-context-manager with enhanced 80% auto-save/clear functionality

VERSION="1.0.0-memre-quest"
ORIGINAL_TOOL="/home/tabs/ai-dev-suite/bin/claude-context-manager"

# Colors for branding
MEMRE_BLUE='\033[0;34m'
MEMRE_GREEN='\033[0;32m'
MEMRE_YELLOW='\033[1;33m'
MEMRE_CYAN='\033[0;36m'
NC='\033[0m'

# MEMre.quest banner
show_banner() {
    echo -e "${MEMRE_BLUE}"
    echo "  โโโโ   โโโโโโโโโโโโโโโโ   โโโโโโโโโโโ โโโโโโโโ   โโโโโโโ โโโ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "  โโโโโ โโโโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโ"  
    echo "  โโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโ     โโโ   โโโโโโ   โโโโโโโโโ  โโโโโโโโ   โโโ"
    echo "  โโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโ     โโโโโ โโโโโโ   โโโโโโโโโ  โโโโโโโโ   โโโ"
    echo "  โโโ โโโ โโโโโโโโโโโโโโ โโโ โโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โโโ"
    echo "  โโโ     โโโโโโโโโโโโโโ     โโโโโโ  โโโโโโโโโโโโโโ โโโโโโโ  โโโโโโโ โโโโโโโโโโโโโโโโ   โโโ"
    echo -e "${NC}"
    echo -e "${MEMRE_CYAN}๐ง Advanced LLM Memory & Context Window Management${NC}"
    echo -e "${MEMRE_GREEN}๐ 80% Context Auto-Save/Clear โข ๐ Conversation Persistence โข ๐พ Memory Updates${NC}"
    echo ""
}

# Check if original tool exists
if [ ! -f "$ORIGINAL_TOOL" ]; then
    echo -e "${MEMRE_YELLOW}โ MEMre.quest: claude-context-manager not found at $ORIGINAL_TOOL${NC}"
    echo -e "${MEMRE_CYAN}๐ก Please ensure AI Dev Suite is properly installed${NC}"
    exit 1
fi

# Handle help and version specially
case "${1:-}" in
    --version|-v)
        show_banner
        echo -e "MEMre.quest version: ${MEMRE_GREEN}$VERSION${NC}"
        echo -e "Based on: claude-context-manager v3.0.0"
        echo ""
        echo -e "${MEMRE_BLUE}Key Features:${NC}"
        echo "โข ๐ฏ 80% context window threshold monitoring"  
        echo "โข ๐พ Automatic conversation save before rotation"
        echo "โข ๐ Intelligent context window clearing" 
        echo "โข ๐ Memory updates with conversation persistence"
        echo "โข ๐ค Multi-AI service conversation tracking"
        echo "โข ๐ Advanced search and retrieval capabilities"
        exit 0
        ;;
    --help|-h|help)
        show_banner
        echo -e "${MEMRE_BLUE}MEMre.quest - Advanced LLM Memory Management${NC}"
        echo ""
        echo -e "${MEMRE_GREEN}Usage:${NC} memre-quest [COMMAND]"
        echo ""
        echo -e "${MEMRE_BLUE}Memory Management Commands:${NC}"
        echo "  start       ๐ Start automatic 80% context monitoring"
        echo "  stop        ๐ Stop the memory management daemon"
        echo "  status      ๐ Show context usage and memory stats"
        echo "  rotate      ๐ Force context window rotation with save"
        echo "  prune       ๐งน Clean old memory while preserving critical data"
        echo "  logs        ๐ View memory management activity logs"
        echo ""
        echo -e "${MEMRE_BLUE}Advanced Features:${NC}"
        echo "โข Monitors context window usage in real-time"
        echo "โข Automatically saves conversations at 80% capacity"
        echo "โข Intelligently clears context while preserving critical memory"
        echo "โข Updates conversation memory across AI services"
        echo "โข Provides seamless conversation continuation"
        echo ""
        echo -e "${MEMRE_CYAN}Examples:${NC}"
        echo "  memre-quest start     # Begin monitoring with 80% auto-save"
        echo "  memre-quest status    # Check current memory usage"
        echo "  memre-quest rotate    # Force save & clear now"
        echo ""
        exit 0
        ;;
    "")
        show_banner
        echo -e "${MEMRE_GREEN}Use 'memre-quest --help' for usage information${NC}"
        echo -e "${MEMRE_CYAN}Quick start: 'memre-quest start' to begin 80% auto-monitoring${NC}"
        exit 0
        ;;
esac

# Pass all other commands to the original claude-context-manager
echo -e "${MEMRE_CYAN}๐ง MEMre.quest executing: $@${NC}"
exec "$ORIGINAL_TOOL" "$@"